import{a as _,r as l,h as k,e as x,j as e,i as U,k as M,u as F}from"./index-BLOQ8UXG.js";import{L as P}from"./LayoutDashboard-Dz0qO7u_.js";import{H as q}from"./SupportDashboard-BzR7KOuZ.js";import{u as S,b as z}from"./ValidationSchema-Cjc3T-T2.js";import{M as L}from"./Profile-u7nIDfV3.js";import"./AiBuilderSupport-CQgpAMnV.js";import"./black-logo-KPU1N9jl.js";import"./AuthSupport-B8dEn6s0.js";function E({type:d,onOpen:i,onClose:o,refreshData:n,userId:m}){_.defaults.withCredentials=!0;const[b,v]=l.useState([]),[t,s]=l.useState({email:"",username:"",phoneNumber:"",roleID:""}),[r,u]=l.useState({userID:"",role:""}),[h,y]=l.useState(!1),N=l.useRef(null),{toastMessage:C,toastPromise:g,token:p,user:D}=k();l.useEffect(()=>{_.get(x.role,{headers:{Authorization:`Bearer ${p}`}}).then(a=>{v(a.data.data)}).catch(a=>{console.error("Error fetching roles:",a)})},[x.role,p]);const j=l.useCallback(a=>{N.current&&!N.current.contains(a.target)&&y(!1)},[N]);l.useEffect(()=>(h?document.addEventListener("mousedown",j):document.removeEventListener("mousedown",j),()=>{document.removeEventListener("mousedown",j)}),[h]),l.useEffect(()=>{i&&d==="update"&&_.get(`${x.userId}?userID=${m}`,{headers:{Authorization:`Bearer ${p}`}}).then(a=>{u({userID:a.data.data.user_id,role:a.data.data.role_id})}).catch(a=>{console.error("Error fetching user data:",a)})},[i,d,x.userId,m,p]);const w=a=>{const{name:c,value:f}=a.target;s({...t,[c]:f})},$=l.useCallback(a=>{a.preventDefault(),d==="create"?S.validate(t,{abortEarly:!1}).then(()=>{const c=_.post(x.addAdmin,t,{headers:{Authorization:`Bearer ${p}`}});g(c,{pending:"Adding user data on progress, please wait..!",success:"Data has been successfully added!",error:"Failed to add data!"},{autoClose:2500,position:"top-center"},()=>{o(),n()}),c.catch(f=>{console.error("Error adding user data:",f)})}).catch(c=>{c.inner.forEach(f=>{C("error",f.message)})}):(console.log(r),z.validate(r,{abortEarly:!1}).then(()=>{const c=_.put(x.updateUserRole,r,{headers:{Authorization:`Bearer ${p}`}});g(c,{pending:"Updating user role data on progress, please wait..!",success:"Data has been successfully updated!",error:"Failed to update data!"},{autoClose:2500,position:"top-center"},()=>{o(),n()}),c.catch(f=>{console.error("Error updating user role data:",f)})}).catch(c=>{c.inner.forEach(f=>{C("error",f.message)})}))},[S,t,r,o,n,C,g,m,p,x]),A=l.useCallback(a=>{a.preventDefault();const c=_.delete(`${x.userId}?userID=${m}`,{headers:{Authorization:`Bearer ${p}`}});g(c,{pending:"deleting user data on progress, please wait..!",success:"Data has been successfully deleted!",error:"Failed to delete data!"},{autoClose:2500,position:"top-center"},()=>{o(),n()}),c.catch(f=>{console.error("Error deleting user data:",f)})},[m,p,o,n]);return e.jsx(e.Fragment,{children:d==="delete"?e.jsx(L,{onClose:o,onOpen:i,type:"confirm",titleModal:"Are you sure you want to delete this?",descModal:"Your content will be permanently deleted. This can't be undone.",children:e.jsxs("div",{className:"confirm-dashboard-action",children:[e.jsx("div",{className:"cancel",onClick:o,children:"cancel"}),e.jsx("div",{className:"confirm",onClick:A,children:"delete"})]})}):e.jsx(L,{titleModal:d==="create"?"Insert Section Data":"Update Section Data",onOpen:i,onClose:o,children:e.jsxs("form",{className:"modal-dashboard-form",onSubmit:$,children:[d==="create"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"username",children:["Username ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"username",name:"username",placeholder:"Example",value:t.username,onChange:w})]}),e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"email",name:"email",placeholder:"example@gmail.com",value:t.email,onChange:w})]}),e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"phoneNumber",children:["Phone Number ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"phoneNumber",name:"phoneNumber",placeholder:"628123456789",value:t.phoneNumber,onChange:w})]})]}):null,e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("div",{className:"label",children:["Role ",e.jsx("span",{children:"(Required)"})]}),e.jsxs("div",{className:"select-default",onClick:()=>y(!0),children:[e.jsx("div",{className:"text",children:r.role===""?"Choose Role":b.filter(a=>a.role_id===r.role).map(a=>a.role_name)}),e.jsx("span",{className:`material-symbols-outlined ${h?"default-closed":""}`,children:"south_east"})]}),h&&e.jsx("div",{className:"select-list no-more",ref:N,children:b.filter(a=>a.role_id!==r.role&&a.role_id!=="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"&&(D.role_id!=="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?a.role_id!=="0057ae60-509f-40de-a637-b2b6fdc1569e":a.role_id)).map(a=>e.jsx("div",{className:"select-list-item",onClick:()=>{u({...r,role:a.role_id}),y(!1)},children:e.jsx("div",{className:"name",children:a.role_name})},a.role_id))})]}),e.jsx("button",{type:"submit",children:"Submit"})]})})})}function R({isLoadingDashboard:d,users:i,user:o,setUserId:n,setIsUpdateModalOpen:m,setIsDeleteModalOpen:b,type:v}){const{search:t}=U();return e.jsxs(e.Fragment,{children:[d&&e.jsx(M,{}),v==="grid"?e.jsx("div",{className:"display-users-grid",children:i.filter(s=>{const r=t.toLowerCase();return s.username.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)||s.phone_number.includes(r)||s.roles.role_name.toLowerCase().includes(r)}).map(s=>{const r=`/avatar/${s.avatar}`,u=o.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80":s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"||s.role_id==="0057ae60-509f-40de-a637-b2b6fdc1569e";return e.jsxs("div",{className:"item",children:[e.jsx("img",{className:"item-avatar",src:r,alt:"Avatar's User"}),e.jsx("div",{className:"item-username",children:s.username}),e.jsx("div",{className:"item-email",children:s.email}),e.jsxs("div",{className:"item-phone-number",children:["+",s.phone_number]}),e.jsxs("div",{className:"item-action",children:[e.jsxs("div",{className:`item-action-role ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:[e.jsx("span",{className:`material-symbols-outlined item-action-role-icon ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name==="super admin"?"admin_panel_settings":s.roles.role_name==="admin"?"manage_accounts":s.roles.role_name==="customer"?"person":"deployed_code_account"}),e.jsx("span",{className:`item-action-role-text ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name||"Super Whooo"})]}),e.jsx("span",{className:"material-symbols-rounded item-action-edit",onClick:u?null:()=>{m(!0),n(s.user_id)},children:u?"block":"edit_square"}),e.jsx("span",{className:"material-symbols-rounded item-action-delete",onClick:u?null:()=>{b(!0),n(s.user_id)},children:u?"block":"delete"})]})]},s.user_id)})}):e.jsxs("div",{className:"display-users-list",children:[e.jsxs("div",{className:"head",children:[e.jsx("div",{className:"head-col",children:"No"}),e.jsx("div",{className:"head-col",children:"General Info"}),e.jsx("div",{className:"head-col",children:"Phone Number"}),e.jsx("div",{className:"head-col",children:"Role"}),e.jsx("div",{className:"head-col",children:"Action"})]}),i.filter(s=>{const r=t.toLowerCase();return s.avatar.toLowerCase().includes(r)||s.username.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)||s.phone_number.includes(r)||s.roles.role_name.toLowerCase().includes(r)}).map((s,r)=>{const u=`/avatar/${s.avatar}`,h=o.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80":s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"||s.role_id==="0057ae60-509f-40de-a637-b2b6fdc1569e";return e.jsxs("div",{className:"body",children:[e.jsx("div",{className:"body-col",children:r+1}),e.jsxs("div",{className:"body-col",children:[e.jsx("img",{className:"avatar",src:u,alt:"Avatar's User"}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"info-username",children:s.username}),e.jsx("div",{className:"info-email",children:s.email})]})]}),e.jsxs("div",{className:"body-col",children:["+",s.phone_number]}),e.jsx("div",{className:"body-col",children:e.jsx("div",{className:`body-col-role ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name||"Super Whooo"})}),e.jsxs("div",{className:"body-col",children:[e.jsx("span",{className:"material-symbols-rounded edit",onClick:h?null:()=>{m(!0),n(s.user_id)},children:h?"block":"edit_square"}),e.jsx("span",{className:"material-symbols-rounded delete",onClick:h?null:()=>{b(!0),n(s.user_id)},children:h?"block":"delete"})]})]},s.user_id)})]})]})}function B(){_.defaults.withCredentials=!0;const[d,i]=l.useState([]),[o,n]=l.useState("list"),[m,b]=l.useState(!1),[v,t]=l.useState(!1),[s,r]=l.useState(!1),[u,h]=l.useState(""),{token:y,user:N,isLoadingDashboard:C,setDashboardLoader:g}=k(),p=l.useCallback(j=>{n(j)},[]),D=l.useCallback(async()=>{g(!0);try{const j=await _.get(x.allusers,{headers:{Authorization:`Bearer ${y}`}});i(j.data.data)}catch(j){console.error(j)}finally{g(!1)}},[x.allusers,y]);return l.useEffect(()=>{D()},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"display-users",children:[e.jsx(q,{className:"display-users",title:"Users Management â€” Display Data",activeDisplay:o,handleDisplayChange:p,setIsCreateModalOpen:b}),o==="grid"?e.jsx(R,{isLoadingDashboard:C,users:d,user:N,setUserId:h,setIsUpdateModalOpen:t,setIsDeleteModalOpen:r,type:"grid"}):e.jsx(R,{isLoadingDashboard:C,users:d,user:N,setUserId:h,setIsUpdateModalOpen:t,setIsDeleteModalOpen:r,type:"list"}),e.jsx(E,{type:"create",onOpen:m,onClose:()=>b(!1),refreshData:D}),e.jsx(E,{type:"update",onOpen:v,onClose:()=>t(!1),refreshData:D,userId:u}),e.jsx(E,{type:"delete",onOpen:s,onClose:()=>r(!1),refreshData:D,userId:u})]})})}function J(){const{submenuPage:d,accessMenus:i,user:o}=k(),n=F();return l.useEffect(()=>{const m=setTimeout(()=>{(i==null?void 0:i.some(v=>v.role_id===(o==null?void 0:o.role_id)&&v.menu_id==="3e1f3895-691f-4962-af43-225d73cfcf91"))===!1&&n("/403",{replace:!0})},1e4);return()=>clearTimeout(m)},[i,o,n]),e.jsx(e.Fragment,{children:e.jsx(P,{children:d==="display data"&&e.jsx(B,{})})})}export{J as default};
