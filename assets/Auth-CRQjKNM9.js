import{a as g,r as i,u as z,b as H,c as T,t as d,d as j,e as N,j as V,f as t,g as P,Q as G}from"./index-CMOvAOI6.js";import{l as Q}from"./black-logo-KPU1N9jl.js";import{s as Z}from"./ValidationSchema-m6anahiY.js";import{A as _,a as q,b as B,c as J}from"./AuthSupport-BsZ_FME2.js";import{C as K}from"./index-4KdN5x27.js";function ee({typeMain:l}){g.defaults.withCredentials=!0;const h=new K(null,{path:"/"}),[n,m]=i.useState({email:"",username:"",phoneNumber:"",password:""}),[E,L]=i.useState([]),[$,F]=i.useState(!0),[k,f]=i.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[b,y]=i.useState(62),v=i.useRef(null),x=i.useRef(null),u=z(),c=H(),[p]=T();i.useEffect(()=>{const r=p.get("message"),s=p.get("shopify-bliss"),e=p.get("role"),a=new URLSearchParams(window.location.search);if(r){d("success",r,{position:"top-center"}),a.delete("message");const o=a.toString()?`${window.location.pathname}?${a.toString()}`:window.location.pathname;window.history.replaceState({},document.title,o)}else if(s&&e){h.set("shopify-bliss",s),a.delete("shopify-bliss"),a.delete("role");const o=a.toString()?`${window.location.pathname}?${a.toString()}`:window.location.pathname;window.history.replaceState({},document.title,o),u("/dashboard",{state:{messageLoginGoogle:"Login successfully!"}})}},[p,h,u]),i.useEffect(()=>{g.get("https://restcountries.com/v3.1/all").then(r=>{const a=r.data.filter(o=>o.idd&&o.idd.root).map(o=>{const w=o.flags.png,D=o.name.common,C=o.idd.root.replace("+",""),S=o.idd.suffixes,I=`+${C}${S[0]}`,U=parseInt(`${C}${S[0]}`);return{flag:w,name:D,codes:I,valueCodes:U}}).sort((o,w)=>o.name.localeCompare(w.name));L(a)}).catch(r=>{console.error(r)})},[]);const A=i.useCallback(r=>{const{name:s,value:e}=r.target;m(a=>({...a,[s]:e})),s==="password"&&f({length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#^()_\-+=]/.test(e)})},[m,f]),R=i.useCallback(r=>{if(r.preventDefault(),l==="signup")Z.validate({email:n.email,username:n.username,phoneNumber:n.phoneNumber,password:n.password},{abortEarly:!1}).then(()=>{const s=g.post(j.signupForm,{email:n.email,username:n.username,phoneNumber:b+n.phoneNumber,password:n.password});N(s,{pending:"Signup in progress, please wait..",success:"Signup successful! ðŸŽ‰",error:"Failed to signup, please try again!"},{autoClose:3500,position:"top-center"},()=>{v.current===!0&&u("/verify-code",{state:{email:n.email}})}),s.then(e=>{v.current=e.data.success,m(""),f({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1})}).catch(e=>{console.error(e),d("error",e,{position:"top-center"})})}).catch(s=>{s.inner.forEach(e=>{d("error",e.message,{position:"top-center",autoClose:3500})})});else{const s=g.post(j.loginForm,{email:n.email,password:n.password});N(s,{pending:"Login in progress, please wait.",success:"Login successful! ðŸŽ‰",error:"Failed to login, please try again!"},{position:"top-center"},()=>{x.current===200&&u("/dashboard")}),s.then(e=>{const a=e.data.token;x.current=e.status,h.set("shopify-bliss",a),V(a).role||d("error","Access denied. Role not recognized."),m("")}).catch(e=>{console.error(e)})}},[n,l]);return i.useEffect(()=>{var r,s;(r=c.state)!=null&&r.messageLogout?(d("success",c.state.messageLogout),u(c.pathname,{state:{...c.state,messageLogout:void 0},replace:!0})):(s=c.state)!=null&&s.messageNoEmail&&(d("warn",c.state.messageNoEmail,{position:"top-center",autoClose:5e3}),u(c.pathname,{state:{...c.state,messageNoEmail:void 0},replace:!0}))},[c.state,u,d,c.pathname]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"auth",children:[t.jsx("div",{className:"auth-header",children:t.jsx(_,{type:l})}),t.jsxs("div",{className:"auth-content",children:[t.jsx(q,{logo:Q,type:l}),t.jsxs("div",{className:`auth-content-core ${l==="signup"?"signup":""}`,children:[t.jsx(B,{values:n,hidePassword:$,setHidePassword:F,validationPassword:k,handleChange:A,handleForm:R,type:l,phoneCodes:E,selectedCode:b,setSelectedCode:y}),l==="login"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"divider"}),t.jsx(J,{type:l,toastDevelop:P})]})]}),l==="login"?t.jsx("span",{className:"auth-content-problems",onClick:()=>P("can't log in"),children:"Can't Log In"}):""]})]}),t.jsx(G,{})]})}export{ee as default};
