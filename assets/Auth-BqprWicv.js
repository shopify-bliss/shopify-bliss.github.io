import{a as d,r as l,u as U,b as D,c as H,t as p,d as C,e as N,f as j,j as a,g as V,L as z,Q as G,P as Q}from"./index-C4l_2Wgo.js";import{l as Z}from"./black-logo-KPU1N9jl.js";import{s as _}from"./ValidationSchema-Obo53iI1.js";import{A as q,a as B,b as J,c as K}from"./AuthSupport-D9y-AtW2.js";function O({typeMain:u}){d.defaults.withCredentials=!0;const[o,m]=l.useState({email:"",username:"",phoneNumber:"",password:""}),[E,P]=l.useState([]),[L,y]=l.useState(!0),[T,g]=l.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[h,$]=l.useState(62),S=l.useRef(null),v=l.useRef(null),c=U(),s=D(),[f]=H();l.useEffect(()=>{const n=f.get("message"),t=f.get("shopify-bliss"),e=new URLSearchParams(window.location.search);if(n){p("success",n,{position:"top-center"}),e.delete("message");const r=e.toString()?`${window.location.pathname}?${e.toString()}`:window.location.pathname;window.history.replaceState({},document.title,r)}else if(t){C.set("shopify-bliss",t,{path:"/",secure:!0,sameSite:"Strict"}),e.delete("shopify-bliss");const r=e.toString()?`${window.location.pathname}?${e.toString()}`:window.location.pathname;window.history.replaceState({},document.title,r),c("/dashboard",{state:{messageLoginGoogle:"Login successfully!"}})}},[f,c]),l.useEffect(()=>{d.get("https://restcountries.com/v3.1/all").then(n=>{const r=n.data.filter(i=>i.idd&&i.idd.root).map(i=>{const w=i.flags.png,A=i.name.common,x=i.idd.root.replace("+",""),b=i.idd.suffixes,R=`+${x}${b[0]}`,I=parseInt(`${x}${b[0]}`);return{flag:w,name:A,codes:R,valueCodes:I}}).sort((i,w)=>i.name.localeCompare(w.name));P(r)}).catch(n=>{console.error(n)})},[]);const k=l.useCallback(n=>{const{name:t,value:e}=n.target;m(r=>({...r,[t]:e})),t==="password"&&g({length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#^()_\-+=]/.test(e)})},[m,g]),F=l.useCallback(n=>{if(n.preventDefault(),u==="signup")_.validate({email:o.email,username:o.username,phoneNumber:o.phoneNumber,password:o.password},{abortEarly:!1}).then(()=>{const t=d.post(N.signupForm,{email:o.email,username:o.username,phoneNumber:h+o.phoneNumber,password:o.password});j(t,{pending:"Signup in progress, please wait..",success:"Signup successful! ðŸŽ‰",error:"Failed to signup, please try again!"},{autoClose:3500,position:"top-center"},()=>{S.current===!0&&c("/verify-email",{state:{email:o.email}})}),t.then(e=>{S.current=e.data.success,m(""),g({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1})}).catch(e=>{console.error(e),p("error",e,{position:"top-center"})})}).catch(t=>{t.inner.forEach(e=>{p("error",e.message,{position:"top-center",autoClose:3500})})});else{const t=d.post(N.loginForm,{email:o.email,password:o.password});j(t,{pending:"Login in progress, please wait.",success:"Login successful! ðŸŽ‰",error:"Failed to login, please try again!"},{position:"top-center"},()=>{v.current===200&&c("/")}),t.then(e=>{const r=e.data.token;v.current=e.status,C.set("shopify-bliss",r,{path:"/",secure:!0,sameSite:"Strict"}),m("")}).catch(e=>{console.error(e)})}},[o,u,h,c]);return l.useEffect(()=>{var n,t,e,r,i;(n=s.state)!=null&&n.messageLogout?(p("success",s.state.messageLogout),c(s.pathname,{state:{...s.state,messageLogout:void 0},replace:!0})):(t=s.state)!=null&&t.messageNoEmail?(p("warn",s.state.messageNoEmail,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageNoEmail:void 0},replace:!0})):(e=s.state)!=null&&e.messageTimeout?(p("info",s.state.messageTimeout,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageTimeout:void 0},replace:!0})):(r=s.state)!=null&&r.messageSessionExpired?(p("info",s.state.messageSessionExpired,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageSessionExpired:void 0},replace:!0})):(i=s.state)!=null&&i.messageNoToken&&(p("info",s.state.messageNoToken,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageNoToken:void 0},replace:!0}))},[s.state,c,s.pathname]),a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"auth",children:[a.jsx("div",{className:"auth-header",children:a.jsx(q,{type:u})}),a.jsxs("div",{className:"auth-content",children:[a.jsx(B,{logo:Z,type:u}),a.jsxs("div",{className:`auth-content-core ${u==="signup"?"signup":""}`,children:[a.jsx(J,{values:o,hidePassword:L,setHidePassword:y,validationPassword:T,handleChange:k,handleForm:F,type:u,phoneCodes:E,selectedCode:h,setSelectedCode:$}),u==="login"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"divider"}),a.jsx(K,{type:u,toastDevelop:V})]})]}),u==="login"?a.jsx(z,{to:"/recovery",className:"auth-content-problems",children:"Can't Log In"}):""]})]}),a.jsx(G,{})]})}O.propTypes={typeMain:Q.string};export{O as default};
