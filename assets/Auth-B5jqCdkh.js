import{a as g,r as l,u as D,b as H,c as V,t as m,d as C,e as j,f as N,j as t,g as P,Q as z}from"./index-De2FbLnl.js";import{l as G}from"./black-logo-KPU1N9jl.js";import{s as Q}from"./ValidationSchema-ym9zi7kY.js";import{A as Z,a as _,b as q,c as B}from"./AuthSupport-JXJjKzqc.js";function X({typeMain:c}){g.defaults.withCredentials=!0;const[o,p]=l.useState({email:"",username:"",phoneNumber:"",password:""}),[E,L]=l.useState([]),[$,F]=l.useState(!0),[y,h]=l.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[w,A]=l.useState(62),S=l.useRef(null),b=l.useRef(null),u=D(),a=H(),[d]=V();l.useEffect(()=>{const n=d.get("message"),s=d.get("shopify-bliss"),e=d.get("role"),r=new URLSearchParams(window.location.search);if(n){m("success",n,{position:"top-center"}),r.delete("message");const i=r.toString()?`${window.location.pathname}?${r.toString()}`:window.location.pathname;window.history.replaceState({},document.title,i)}else if(s&&e){C.set("shopify-bliss",s,{path:"/",secure:!0,sameSite:"Strict"}),r.delete("shopify-bliss"),r.delete("role");const i=r.toString()?`${window.location.pathname}?${r.toString()}`:window.location.pathname;window.history.replaceState({},document.title,i),u("/dashboard",{state:{messageLoginGoogle:"Login successfully!"}})}},[d,u]),l.useEffect(()=>{g.get("https://restcountries.com/v3.1/all").then(n=>{const r=n.data.filter(i=>i.idd&&i.idd.root).map(i=>{const f=i.flags.png,T=i.name.common,v=i.idd.root.replace("+",""),x=i.idd.suffixes,I=`+${v}${x[0]}`,U=parseInt(`${v}${x[0]}`);return{flag:f,name:T,codes:I,valueCodes:U}}).sort((i,f)=>i.name.localeCompare(f.name));L(r)}).catch(n=>{console.error(n)})},[]);const k=l.useCallback(n=>{const{name:s,value:e}=n.target;p(r=>({...r,[s]:e})),s==="password"&&h({length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#^()_\-+=]/.test(e)})},[p,h]),R=l.useCallback(n=>{if(n.preventDefault(),c==="signup")Q.validate({email:o.email,username:o.username,phoneNumber:o.phoneNumber,password:o.password},{abortEarly:!1}).then(()=>{const s=g.post(j.signupForm,{email:o.email,username:o.username,phoneNumber:w+o.phoneNumber,password:o.password});N(s,{pending:"Signup in progress, please wait..",success:"Signup successful! ðŸŽ‰",error:"Failed to signup, please try again!"},{autoClose:3500,position:"top-center"},()=>{S.current===!0&&u("/verify-email",{state:{email:o.email}})}),s.then(e=>{S.current=e.data.success,p(""),h({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1})}).catch(e=>{console.error(e),m("error",e,{position:"top-center"})})}).catch(s=>{s.inner.forEach(e=>{m("error",e.message,{position:"top-center",autoClose:3500})})});else{const s=g.post(j.loginForm,{email:o.email,password:o.password});N(s,{pending:"Login in progress, please wait.",success:"Login successful! ðŸŽ‰",error:"Failed to login, please try again!"},{position:"top-center"},()=>{b.current===200&&u("/dashboard")}),s.then(e=>{const r=e.data.token;b.current=e.status,C.set("shopify-bliss",r,{path:"/",secure:!0,sameSite:"Strict"}),p("")}).catch(e=>{console.error(e)})}},[o,c]);return l.useEffect(()=>{var n,s,e;(n=a.state)!=null&&n.messageLogout?(m("success",a.state.messageLogout),u(a.pathname,{state:{...a.state,messageLogout:void 0},replace:!0})):(s=a.state)!=null&&s.messageNoEmail?(m("warn",a.state.messageNoEmail,{position:"top-center",autoClose:5e3}),u(a.pathname,{state:{...a.state,messageNoEmail:void 0},replace:!0})):(e=a.state)!=null&&e.messageTimeout&&(m("info",a.state.messageTimeout,{position:"top-center",autoClose:5e3}),u(a.pathname,{state:{...a.state,messageTimeout:void 0},replace:!0}))},[a.state,u,m,a.pathname]),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"auth",children:[t.jsx("div",{className:"auth-header",children:t.jsx(Z,{type:c})}),t.jsxs("div",{className:"auth-content",children:[t.jsx(_,{logo:G,type:c}),t.jsxs("div",{className:`auth-content-core ${c==="signup"?"signup":""}`,children:[t.jsx(q,{values:o,hidePassword:$,setHidePassword:F,validationPassword:y,handleChange:k,handleForm:R,type:c,phoneCodes:E,selectedCode:w,setSelectedCode:A}),c==="login"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"divider"}),t.jsx(B,{type:c,toastDevelop:P})]})]}),c==="login"?t.jsx("span",{className:"auth-content-problems",onClick:()=>P("can't log in"),children:"Can't Log In"}):""]})]}),t.jsx(z,{})]})}export{X as default};
