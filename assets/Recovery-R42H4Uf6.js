import{a as w,r as o,u as E,b as S,e as h,f as x,t as f,j as e,Q as R}from"./index-BLOQ8UXG.js";import{l as F}from"./black-logo-KPU1N9jl.js";import{r as b,a as A}from"./ValidationSchema-Cjc3T-T2.js";import{A as k,a as H,d as V}from"./AuthSupport-B8dEn6s0.js";function L({typeMain:t}){w.defaults.withCredentials=!0;const[r,c]=o.useState({email:"",oldPassword:"",newPassword:""}),[u,j]=o.useState(!0),[m,y]=o.useState(!0),[N,v]=o.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),P=o.useRef(null),g=o.useRef(null),d=E(),l=S(),p=o.useCallback(n=>{const{name:a,value:s}=n.target;c(i=>({...i,[a]:s})),a==="newPassword"&&v({length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),special:/[@$!%*?&#^()_\-+=]/.test(s)})},[c,v]),C=o.useCallback(n=>{if(n.preventDefault(),t==="recovery")b.validate({email:r.email},{abortEarly:!1}).then(()=>{const a=w.post(h.sendOtpPassword,{email:r.email});x(a,{pending:"Recovery in progress, please wait..",success:"Recovery successful! ðŸŽ‰",error:"Failed to recovery, please try again!"},{autoClose:3500,position:"top-center"},()=>{P.current===!0&&d("/verify-password",{state:{email:r.email}})}),a.then(s=>{P.current=s.data.success,c("")}).catch(s=>{console.error(s)})}).catch(a=>{a.inner.forEach(s=>{f("error",s.message,{position:"top-center",autoClose:3500})})});else{const a={oldPassword:r.oldPassword,newPassword:r.newPassword};A.validate(a,{abortEarly:!1}).then(()=>{const s=w.put(h.updatePassword,a);x(s,{pending:"Reset password on progress, please wait..!",success:"Reset password has been successfully updated!",error:"Failed to reset password!"},{autoClose:2500,position:"top-center"},()=>{g.current===!0&&d("/login")}),s.then(i=>{g.current=i.data.success,c("")}).catch(i=>{console.error("Error updating password:",i)})}).catch(s=>{s.inner.forEach(i=>{f("error",i.message)})})}},[b,h.sendOtpPassword,r,t]);return o.useEffect(()=>{var n,a;t==="reset-password"&&!l.state&&d("/recovery",{state:{messageNoEmail:"Email is missing. Please go back to the previous step and ensure your email is entered correctly!"}}),(t==="recovery"&&((n=l.state)!=null&&n.messageNoEmail)||t==="reset-password"&&((a=l.state)!=null&&a.messageNoEmail))&&(f("warn",l.state.messageNoEmail,{position:"top-center",autoClose:5e3}),d(l.pathname,{state:{...l.state,messageNoEmail:void 0},replace:!0}))},[l.state,d,l.pathname,t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"auth",children:[e.jsx("div",{className:"auth-header",children:e.jsx(k,{type:t})}),e.jsxs("div",{className:"auth-content",children:[e.jsx(H,{logo:F,type:t}),e.jsx("div",{className:"auth-content-core recovery",children:e.jsxs("form",{className:"form",onSubmit:C,children:[t==="recovery"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{className:"form-group-input",type:"text",id:"email",name:"email",autoComplete:"email",placeholder:"example@gmail.com",onChange:p,value:r.email||""}),e.jsx("div",{className:"input-border"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"oldPassword",children:"Current Password"}),e.jsx("input",{className:"form-group-input",type:u?"password":"text",id:"oldPassword",name:"oldPassword",autoComplete:"current-password",placeholder:"oldPassword",onChange:p,value:r.oldPassword||""}),e.jsx("span",{className:"material-symbols-outlined",onClick:()=>j(!u),children:u?"visibility_off":"visibility"}),e.jsx("div",{className:"input-border"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"newPassword",children:"Set Password"}),e.jsx("input",{className:"form-group-input",type:m?"password":"text",id:"newPassword",name:"newPassword",autoComplete:"current-password",placeholder:"newPassword",onChange:p,value:r.newPassword||""}),e.jsx("span",{className:"material-symbols-outlined",onClick:()=>y(!m),children:m?"visibility_off":"visibility"}),e.jsx("div",{className:"input-border"})]}),e.jsx(V,{validationPassword:N})]}),e.jsx("button",{type:"submit",className:"form-submit",disabled:t==="recovery"?!r.email:!r.oldPassword||!r.newPassword,children:"Submit"})]})})]})]}),e.jsx(R,{})]})}export{L as default};
