import{a as p,C as K,r as i,u as Q,b as Z,c as _,t as d,d as C,e as y,j as q,f as t,g as L,Q as J}from"./index-BZSCxJql.js";import{l as O}from"./black-logo-KPU1N9jl.js";import{s as W}from"./ValidationSchema-CdbMnuiI.js";import{A as X,a as Y,b as M,c as ee}from"./AuthSupport-CMBJa0HJ.js";function ne({typeMain:n}){p.defaults.withCredentials=!0;const f=new K,[l,g]=i.useState({email:"",username:"",phoneNumber:"",password:""}),[k,F]=i.useState([]),[A,D]=i.useState(!0),[R,h]=i.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[j,I]=i.useState(62),[m,S]=i.useState(new Array(6).fill("")),w=i.useRef(null),x=i.useRef(null),E=i.useRef(null),u=Q(),c=Z(),[v]=_();i.useEffect(()=>{const a=v.get("message"),s=v.get("shopify-bliss"),e=v.get("role"),o=new URLSearchParams(window.location.search);if(a){d("success",a,{position:"top-center"}),o.delete("message");const r=o.toString()?`${window.location.pathname}?${o.toString()}`:window.location.pathname;window.history.replaceState({},document.title,r)}else if(s&&e){f.set("shopify-bliss",s),o.delete("shopify-bliss"),o.delete("role");const r=o.toString()?`${window.location.pathname}?${o.toString()}`:window.location.pathname;window.history.replaceState({},document.title,r),e==="admin"?u("/dashboard",{state:{messageLoginGoogle:"Login successfully!"}}):e==="customer"&&u("/profile",{state:{messageLoginGoogle:"Login successfully!"}})}},[f,u]),i.useEffect(()=>{p.get("https://restcountries.com/v3.1/all").then(a=>{const o=a.data.filter(r=>r.idd&&r.idd.root).map(r=>{const b=r.flags.png,G=r.name.common,P=r.idd.root.replace("+",""),$=r.idd.suffixes,H=`+${P}${$[0]}`,T=parseInt(`${P}${$[0]}`);return{flag:b,name:G,codes:H,valueCodes:T}}).sort((r,b)=>r.name.localeCompare(b.name));F(o)}).catch(a=>{console.error(a)})},[]);const V=i.useCallback(a=>{const{name:s,value:e}=a.target;g(o=>({...o,[s]:e})),s==="password"&&h({length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#^()_\-+=]/.test(e)})},[g,h]),B=i.useCallback((a,s)=>{const e=a.target.value.replace(/[^0-9]/g,"");if(e.length<=1){const o=[...m];o[s]=e,S(o),e&&s<5&&document.getElementById(`code-input-${s+1}`).focus()}},[m]),U=a=>{a.preventDefault();const s=a.clipboardData.getData("text").trim();if(/^\d{6}$/.test(s)){const e=s.split("");S(e),document.getElementById("code-input-5").focus()}else d("error","Invalid code format. Please paste 6 digits.")},N=i.useCallback(a=>{if(a.preventDefault(),n==="signup")W.validate({email:l.email,username:l.username,phoneNumber:l.phoneNumber,password:l.password},{abortEarly:!1}).then(()=>{const s=p.post(C.signupForm,{email:l.email,username:l.username,phoneNumber:j+l.phoneNumber,password:l.password});y(s,{pending:"Signup in progress, please wait..",success:"Signup successful! ðŸŽ‰",error:"Failed to signup, please try again!"},{autoClose:3500,position:"top-center"},()=>{x.current===!0&&u("/verify-code",{state:{email:l.email}})}),s.then(e=>{x.current=e.data.success,g(""),h({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1})}).catch(e=>{console.error(e),d("error",e,{position:"top-center"})})}).catch(s=>{s.inner.forEach(e=>{d("error",e.message,{position:"top-center",autoClose:3500})})});else if(n==="login"){const s=p.post(C.loginForm,{email:l.email,password:l.password});y(s,{pending:"Login in progress, please wait.",success:"Login successful! ðŸŽ‰",error:"Failed to login, please try again!"},{position:"top-center"},()=>{w.current==="admin"?u("/dashboard"):w.current==="customer"&&u("/profile")}),s.then(e=>{const o=e.data.token;f.set("shopify-bliss",o);const r=q(o);r.role==="admin"||r.role==="customer"?w.current=r.role:d("error","Access denied. Role not recognized."),g("")}).catch(e=>{console.error(e)})}else{const s=m.join("");if(s.length===6){const e=p.post(C.verifyEmail,{code:s,email:c.state.email});y(e,{pending:"Verification in progress, please wait..",success:"Email verified successfully! ðŸŽ‰",error:"Failed to verify email, please try again!"},{position:"top-center"},()=>{E.current===!0&&u("/login")}),e.then(o=>{E.current=o.data.success}).catch(o=>{console.error(o)})}else d("error","Please enter all 6 digits.")}},[l,n,m]);i.useEffect(()=>{n==="verify"&&!c.state&&u("/login",{state:{messageNoEmail:"Email is missing. Please go back to the previous step (registration) and ensure your email is entered correctly!"}})},[n,u,c.state]),i.useEffect(()=>{var a,s;(a=c.state)!=null&&a.messageLogout?(d("success",c.state.messageLogout),u(c.pathname,{state:{...c.state,messageLogout:void 0},replace:!0})):(s=c.state)!=null&&s.messageNoEmail&&(d("warn",c.state.messageNoEmail,{position:"top-center",autoClose:5e3}),u(c.pathname,{state:{...c.state,messageNoEmail:void 0},replace:!0}))},[c.state,u,d,c.pathname]);const z=n==="verify"?"form":"div";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"auth",children:[t.jsx("div",{className:"auth-header",children:t.jsx(X,{type:n})}),t.jsxs("div",{className:"auth-content",children:[t.jsx(Y,{logo:O,type:n}),t.jsxs(z,{className:`auth-content-core ${n==="signup"?"signup":n==="verify"?"verify":""}`,onSubmit:n==="verify"?N:null,children:[n!=="verify"&&t.jsxs(t.Fragment,{children:[t.jsx(M,{values:l,hidePassword:A,setHidePassword:D,validationPassword:R,handleChange:V,handleForm:N,type:n,phoneCodes:k,selectedCode:j,setSelectedCode:I}),n!=="signup"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"divider"}),t.jsx(ee,{type:n,toastDevelop:L})]})]}),n==="verify"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"verify-wrapper",children:m.map((a,s)=>t.jsx("input",{id:`code-input-${s}`,className:"code-number",type:"text",maxLength:"1",value:a,onChange:e=>B(e,s),onKeyDown:e=>{e.key==="Backspace"&&!m[s]&&s>0&&document.getElementById(`code-input-${s-1}`).focus()},onPaste:U},s))}),t.jsx("button",{className:"code-button",children:"Submit Code"})]})]}),n==="login"?t.jsx("span",{className:"auth-content-problems",onClick:()=>L("can't log in"),children:"Can't Log In"}):""]})]}),t.jsx(J,{})]})}export{ne as default};
