import{a as w,r as o,u as C,b as E,e as g,f as x,t as h,j as e,Q as S,P as R}from"./index-aySjYrsU.js";import{l as F}from"./black-logo-KPU1N9jl.js";import{r as A,a as k}from"./ValidationSchema-D3YOnutq.js";import{A as H,a as T,d as V}from"./AuthSupport-CdrhMnVD.js";function _({typeMain:t}){w.defaults.withCredentials=!0;const[r,c]=o.useState({email:"",oldPassword:"",newPassword:""}),[u,b]=o.useState(!0),[m,j]=o.useState(!0),[y,f]=o.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),v=o.useRef(null),P=o.useRef(null),n=C(),l=E(),p=o.useCallback(d=>{const{name:a,value:s}=d.target;c(i=>({...i,[a]:s})),a==="newPassword"&&f({length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),special:/[@$!%*?&#^()_\-+=]/.test(s)})},[c,f]),N=o.useCallback(d=>{if(d.preventDefault(),t==="recovery")A.validate({email:r.email},{abortEarly:!1}).then(()=>{const a=w.post(g.sendOtpPassword,{email:r.email});x(a,{pending:"Recovery in progress, please wait..",success:"Recovery successful! ðŸŽ‰",error:"Failed to recovery, please try again!"},{autoClose:3500,position:"top-center"},()=>{v.current===!0&&n("/verify-password",{state:{email:r.email}})}),a.then(s=>{v.current=s.data.success,c("")}).catch(s=>{console.error(s)})}).catch(a=>{a.inner.forEach(s=>{h("error",s.message,{position:"top-center",autoClose:3500})})});else{const a={oldPassword:r.oldPassword,newPassword:r.newPassword};k.validate(a,{abortEarly:!1}).then(()=>{const s=w.put(g.updatePassword,a);x(s,{pending:"Reset password on progress, please wait..!",success:"Reset password has been successfully updated!",error:"Failed to reset password!"},{autoClose:2500,position:"top-center"},()=>{P.current===!0&&n("/login")}),s.then(i=>{P.current=i.data.success,c("")}).catch(i=>{console.error("Error updating password:",i)})}).catch(s=>{s.inner.forEach(i=>{h("error",i.message)})})}},[r,t,n]);return o.useEffect(()=>{var d,a;t==="reset-password"&&!l.state&&n("/recovery",{state:{messageNoEmail:"Email is missing. Please go back to the previous step and ensure your email is entered correctly!"}}),(t==="recovery"&&((d=l.state)!=null&&d.messageNoEmail)||t==="reset-password"&&((a=l.state)!=null&&a.messageNoEmail))&&(h("warn",l.state.messageNoEmail,{position:"top-center",autoClose:5e3}),n(l.pathname,{state:{...l.state,messageNoEmail:void 0},replace:!0}))},[l.state,n,l.pathname,t]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"auth",children:[e.jsx("div",{className:"auth-header",children:e.jsx(H,{type:t})}),e.jsxs("div",{className:"auth-content",children:[e.jsx(T,{logo:F,type:t}),e.jsx("div",{className:"auth-content-core recovery",children:e.jsxs("form",{className:"form",onSubmit:N,children:[t==="recovery"?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{className:"form-group-input",type:"text",id:"email",name:"email",autoComplete:"email",placeholder:"example@gmail.com",onChange:p,value:r.email||""}),e.jsx("div",{className:"input-border"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"oldPassword",children:"Current Password"}),e.jsx("input",{className:"form-group-input",type:u?"password":"text",id:"oldPassword",name:"oldPassword",autoComplete:"current-password",placeholder:"oldPassword",onChange:p,value:r.oldPassword||""}),e.jsx("span",{className:"material-symbols-outlined",onClick:()=>b(!u),children:u?"visibility_off":"visibility"}),e.jsx("div",{className:"input-border"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"newPassword",children:"Set Password"}),e.jsx("input",{className:"form-group-input",type:m?"password":"text",id:"newPassword",name:"newPassword",autoComplete:"current-password",placeholder:"newPassword",onChange:p,value:r.newPassword||""}),e.jsx("span",{className:"material-symbols-outlined",onClick:()=>j(!m),children:m?"visibility_off":"visibility"}),e.jsx("div",{className:"input-border"})]}),e.jsx(V,{validationPassword:y})]}),e.jsx("button",{type:"submit",className:"form-submit",disabled:t==="recovery"?!r.email:!r.oldPassword||!r.newPassword,children:"Submit"})]})})]})]}),e.jsx(S,{})]})}_.propTypes={typeMain:R.string};export{_ as default};
