import{P as h,a as N,r as l,h as S,e as w,j as e,i as U,k as M,u as F}from"./index-E8w-6HTq.js";import{L as I}from"./LayoutDashboard-triWywiv.js";import{H as P}from"./SupportDashboard-50pPKL8R.js";import{u as O,b as q}from"./ValidationSchema-t1VtQ1M-.js";import{M as R}from"./Profile-BeLCsDpT.js";import"./AiBuilderSupport-Xg48ppJz.js";import"./black-logo-KPU1N9jl.js";import"./AuthSupport-DA0ygfeY.js";function E({type:t,onOpen:i,onClose:o,refreshData:n,userId:p}){N.defaults.withCredentials=!0;const[j,_]=l.useState([]),[c,s]=l.useState({email:"",username:"",phoneNumber:"",roleID:""}),[r,m]=l.useState({userID:"",role:""}),[u,C]=l.useState(!1),g=l.useRef(null),{toastMessage:D,toastPromise:v,token:f,user:y}=S();l.useEffect(()=>{N.get(w.role,{headers:{Authorization:`Bearer ${f}`}}).then(a=>{_(a.data.data)}).catch(a=>{console.error("Error fetching roles:",a)})},[f]);const x=l.useCallback(a=>{g.current&&!g.current.contains(a.target)&&C(!1)},[g]);l.useEffect(()=>(u?document.addEventListener("mousedown",x):document.removeEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}),[u,x]),l.useEffect(()=>{i&&t==="update"&&N.get(`${w.userId}?userID=${p}`,{headers:{Authorization:`Bearer ${f}`}}).then(a=>{m({userID:a.data.data.user_id,role:a.data.data.role_id})}).catch(a=>{console.error("Error fetching user data:",a)})},[i,p,f,t]);const k=a=>{const{name:d,value:b}=a.target;s({...c,[d]:b})},$=l.useCallback(a=>{a.preventDefault(),t==="create"?O.validate(c,{abortEarly:!1}).then(()=>{const d=N.post(w.addAdmin,c,{headers:{Authorization:`Bearer ${f}`}});v(d,{pending:"Adding user data on progress, please wait..!",success:"Data has been successfully added!",error:"Failed to add data!"},{autoClose:2500,position:"top-center"},()=>{o(),n()}),d.catch(b=>{console.error("Error adding user data:",b)})}).catch(d=>{d.inner.forEach(b=>{D("error",b.message)})}):q.validate(r,{abortEarly:!1}).then(()=>{const d=N.put(w.updateUserRole,r,{headers:{Authorization:`Bearer ${f}`}});v(d,{pending:"Updating user role data on progress, please wait..!",success:"Data has been successfully updated!",error:"Failed to update data!"},{autoClose:2500,position:"top-center"},()=>{o(),n()}),d.catch(b=>{console.error("Error updating user role data:",b)})}).catch(d=>{d.inner.forEach(b=>{D("error",b.message)})})},[t,c,r,o,n,D,v,f]),A=l.useCallback(a=>{a.preventDefault();const d=N.delete(`${w.userId}?userID=${p}`,{headers:{Authorization:`Bearer ${f}`}});v(d,{pending:"deleting user data on progress, please wait..!",success:"Data has been successfully deleted!",error:"Failed to delete data!"},{autoClose:2500,position:"top-center"},()=>{o(),n()}),d.catch(b=>{console.error("Error deleting user data:",b)})},[p,f,o,n,v]);return e.jsx(e.Fragment,{children:t==="delete"?e.jsx(R,{onClose:o,onOpen:i,type:"confirm",titleModal:"Are you sure you want to delete this?",descModal:"Your content will be permanently deleted. This can't be undone.",children:e.jsxs("div",{className:"confirm-dashboard-action",children:[e.jsx("div",{className:"cancel",onClick:o,children:"cancel"}),e.jsx("div",{className:"confirm",onClick:A,children:"delete"})]})}):e.jsx(R,{titleModal:t==="create"?"Insert Section Data":"Update Section Data",onOpen:i,onClose:o,children:e.jsxs("form",{className:"modal-dashboard-form",onSubmit:$,children:[t==="create"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"username",children:["Username ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"username",name:"username",placeholder:"Example",value:c.username,onChange:k})]}),e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"email",name:"email",placeholder:"example@gmail.com",value:c.email,onChange:k})]}),e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"phoneNumber",children:["Phone Number ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"phoneNumber",name:"phoneNumber",placeholder:"628123456789",value:c.phoneNumber,onChange:k})]})]}):null,e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("div",{className:"label",children:["Role ",e.jsx("span",{children:"(Required)"})]}),e.jsxs("div",{className:"select-default",onClick:()=>C(!0),children:[e.jsx("div",{className:"text",children:r.role===""?"Choose Role":j.filter(a=>a.role_id===r.role).map(a=>a.role_name)}),e.jsx("span",{className:`material-symbols-outlined ${u?"default-closed":""}`,children:"south_east"})]}),u&&e.jsx("div",{className:"select-list no-more",ref:g,children:j.filter(a=>a.role_id!==r.role&&a.role_id!=="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"&&(y.role_id!=="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?a.role_id!=="0057ae60-509f-40de-a637-b2b6fdc1569e":a.role_id)).map(a=>e.jsx("div",{className:"select-list-item",onClick:()=>{m({...r,role:a.role_id}),C(!1)},children:e.jsx("div",{className:"name",children:a.role_name})},a.role_id))})]}),e.jsx("button",{type:"submit",children:"Submit"})]})})})}E.propTypes={type:h.string,onOpen:h.bool,onClose:h.func,refreshData:h.func,userId:h.string};function L({isLoadingDashboard:t,users:i,user:o,setUserId:n,setIsUpdateModalOpen:p,setIsDeleteModalOpen:j,type:_}){const{search:c}=U();return e.jsxs(e.Fragment,{children:[t&&e.jsx(M,{}),_==="grid"?e.jsx("div",{className:"display-users-grid",children:i.filter(s=>{const r=c.toLowerCase();return s.username.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)||s.phone_number.includes(r)||s.roles.role_name.toLowerCase().includes(r)}).map(s=>{const r=`/avatar/${s.avatar}`,m=o.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80":s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"||s.role_id==="0057ae60-509f-40de-a637-b2b6fdc1569e";return e.jsxs("div",{className:"item",children:[e.jsx("img",{className:"item-avatar",src:r,alt:"Avatar's User"}),e.jsx("div",{className:"item-username",children:s.username}),e.jsx("div",{className:"item-email",children:s.email}),e.jsxs("div",{className:"item-phone-number",children:["+",s.phone_number]}),e.jsxs("div",{className:"item-action",children:[e.jsxs("div",{className:`item-action-role ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:[e.jsx("span",{className:`material-symbols-outlined item-action-role-icon ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name==="super admin"?"admin_panel_settings":s.roles.role_name==="admin"?"manage_accounts":s.roles.role_name==="customer"?"person":"deployed_code_account"}),e.jsx("span",{className:`item-action-role-text ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name||"Super Whooo"})]}),e.jsx("span",{className:"material-symbols-rounded item-action-edit",onClick:m?null:()=>{p(!0),n(s.user_id)},children:m?"block":"edit_square"}),e.jsx("span",{className:"material-symbols-rounded item-action-delete",onClick:m?null:()=>{j(!0),n(s.user_id)},children:m?"block":"delete"})]})]},s.user_id)})}):e.jsxs("div",{className:"display-users-list",children:[e.jsxs("div",{className:"head",children:[e.jsx("div",{className:"head-col",children:"No"}),e.jsx("div",{className:"head-col",children:"General Info"}),e.jsx("div",{className:"head-col",children:"Phone Number"}),e.jsx("div",{className:"head-col",children:"Role"}),e.jsx("div",{className:"head-col",children:"Action"})]}),i.filter(s=>{const r=c.toLowerCase();return s.avatar.toLowerCase().includes(r)||s.username.toLowerCase().includes(r)||s.email.toLowerCase().includes(r)||s.phone_number.includes(r)||s.roles.role_name.toLowerCase().includes(r)}).map((s,r)=>{const m=`/avatar/${s.avatar}`,u=o.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80":s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"||s.role_id==="0057ae60-509f-40de-a637-b2b6fdc1569e";return e.jsxs("div",{className:"body",children:[e.jsx("div",{className:"body-col",children:r+1}),e.jsxs("div",{className:"body-col",children:[e.jsx("img",{className:"avatar",src:m,alt:"Avatar's User"}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"info-username",children:s.username}),e.jsx("div",{className:"info-email",children:s.email})]})]}),e.jsxs("div",{className:"body-col",children:["+",s.phone_number]}),e.jsx("div",{className:"body-col",children:e.jsx("div",{className:`body-col-role ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name||"Super Whooo"})}),e.jsxs("div",{className:"body-col",children:[e.jsx("span",{className:"material-symbols-rounded edit",onClick:u?null:()=>{p(!0),n(s.user_id)},children:u?"block":"edit_square"}),e.jsx("span",{className:"material-symbols-rounded delete",onClick:u?null:()=>{j(!0),n(s.user_id)},children:u?"block":"delete"})]})]},s.user_id)})]})]})}function z(){N.defaults.withCredentials=!0;const[t,i]=l.useState([]),[o,n]=l.useState("list"),[p,j]=l.useState(!1),[_,c]=l.useState(!1),[s,r]=l.useState(!1),[m,u]=l.useState(""),{token:C,user:g,isLoadingDashboard:D,setDashboardLoader:v}=S(),f=l.useCallback(x=>{n(x)},[]),y=l.useCallback(async()=>{v(!0);try{const x=await N.get(w.allusers,{headers:{Authorization:`Bearer ${C}`}});i(x.data.data)}catch(x){console.error(x)}finally{v(!1)}},[C,v]);return l.useEffect(()=>{y()},[y]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"display-users",children:[e.jsx(P,{className:"display-users",title:"Users Management â€” Display Data",activeDisplay:o,handleDisplayChange:f,setIsCreateModalOpen:j}),o==="grid"?e.jsx(L,{isLoadingDashboard:D,users:t,user:g,setUserId:u,setIsUpdateModalOpen:c,setIsDeleteModalOpen:r,type:"grid"}):e.jsx(L,{isLoadingDashboard:D,users:t,user:g,setUserId:u,setIsUpdateModalOpen:c,setIsDeleteModalOpen:r,type:"list"}),e.jsx(E,{type:"create",onOpen:p,onClose:()=>j(!1),refreshData:y}),e.jsx(E,{type:"update",onOpen:_,onClose:()=>c(!1),refreshData:y,userId:m}),e.jsx(E,{type:"delete",onOpen:s,onClose:()=>r(!1),refreshData:y,userId:m})]})})}L.propTypes={isLoadingDashboard:h.bool,users:h.array,user:h.object,setUserId:h.func,setIsUpdateModalOpen:h.func,setIsDeleteModalOpen:h.func,type:h.string};function K(){const{submenuPage:t,accessMenus:i,user:o}=S(),n=F();return l.useEffect(()=>{const p=setTimeout(()=>{(i==null?void 0:i.some(_=>_.role_id===(o==null?void 0:o.role_id)&&_.menu_id==="3e1f3895-691f-4962-af43-225d73cfcf91"))===!1&&n("/403",{replace:!0})},1e4);return()=>clearTimeout(p)},[i,o,n]),e.jsx(e.Fragment,{children:e.jsx(I,{children:t==="c4f884b7-f98a-40a9-a436-ad293b13d565"&&e.jsx(z,{})})})}export{K as default};
