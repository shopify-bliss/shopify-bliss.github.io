import{a as g,r as l,u as U,b as D,c as H,t as p,d as C,e as N,f as j,j as n,g as V,L as z,Q as G,P as Q}from"./index-b4tCd78A.js";import{l as Z}from"./black-logo-KPU1N9jl.js";import{s as _}from"./ValidationSchema-CUNi3yYx.js";import{A as q,a as B,b as J,c as K}from"./AuthSupport-BD7vGJjL.js";function O({typeMain:u}){g.defaults.withCredentials=!0;const[r,m]=l.useState({email:"",username:"",phoneNumber:"",password:""}),[E,P]=l.useState([]),[L,y]=l.useState(!0),[T,h]=l.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[f,$]=l.useState(62),S=l.useRef(null),v=l.useRef(null),c=U(),s=D(),[d]=H();l.useEffect(()=>{const i=d.get("message"),t=d.get("shopify-bliss"),e=d.get("role"),a=new URLSearchParams(window.location.search);if(i){p("success",i,{position:"top-center"}),a.delete("message");const o=a.toString()?`${window.location.pathname}?${a.toString()}`:window.location.pathname;window.history.replaceState({},document.title,o)}else if(t&&e){C.set("shopify-bliss",t,{path:"/",secure:!0,sameSite:"Strict"}),a.delete("shopify-bliss"),a.delete("role");const o=a.toString()?`${window.location.pathname}?${a.toString()}`:window.location.pathname;window.history.replaceState({},document.title,o),c("/dashboard",{state:{messageLoginGoogle:"Login successfully!"}})}},[d,c]),l.useEffect(()=>{g.get("https://restcountries.com/v3.1/all").then(i=>{const a=i.data.filter(o=>o.idd&&o.idd.root).map(o=>{const w=o.flags.png,A=o.name.common,x=o.idd.root.replace("+",""),b=o.idd.suffixes,R=`+${x}${b[0]}`,I=parseInt(`${x}${b[0]}`);return{flag:w,name:A,codes:R,valueCodes:I}}).sort((o,w)=>o.name.localeCompare(w.name));P(a)}).catch(i=>{console.error(i)})},[]);const k=l.useCallback(i=>{const{name:t,value:e}=i.target;m(a=>({...a,[t]:e})),t==="password"&&h({length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#^()_\-+=]/.test(e)})},[m,h]),F=l.useCallback(i=>{if(i.preventDefault(),u==="signup")_.validate({email:r.email,username:r.username,phoneNumber:r.phoneNumber,password:r.password},{abortEarly:!1}).then(()=>{const t=g.post(N.signupForm,{email:r.email,username:r.username,phoneNumber:f+r.phoneNumber,password:r.password});j(t,{pending:"Signup in progress, please wait..",success:"Signup successful! ðŸŽ‰",error:"Failed to signup, please try again!"},{autoClose:3500,position:"top-center"},()=>{S.current===!0&&c("/verify-email",{state:{email:r.email}})}),t.then(e=>{S.current=e.data.success,m(""),h({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1})}).catch(e=>{console.error(e),p("error",e,{position:"top-center"})})}).catch(t=>{t.inner.forEach(e=>{p("error",e.message,{position:"top-center",autoClose:3500})})});else{const t=g.post(N.loginForm,{email:r.email,password:r.password});j(t,{pending:"Login in progress, please wait.",success:"Login successful! ðŸŽ‰",error:"Failed to login, please try again!"},{position:"top-center"},()=>{v.current===200&&c("/")}),t.then(e=>{const a=e.data.token;v.current=e.status,C.set("shopify-bliss",a,{path:"/",secure:!0,sameSite:"Strict"}),m("")}).catch(e=>{console.error(e)})}},[r,u,f,c]);return l.useEffect(()=>{var i,t,e,a,o;(i=s.state)!=null&&i.messageLogout?(p("success",s.state.messageLogout),c(s.pathname,{state:{...s.state,messageLogout:void 0},replace:!0})):(t=s.state)!=null&&t.messageNoEmail?(p("warn",s.state.messageNoEmail,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageNoEmail:void 0},replace:!0})):(e=s.state)!=null&&e.messageTimeout?(p("info",s.state.messageTimeout,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageTimeout:void 0},replace:!0})):(a=s.state)!=null&&a.messageSessionExpired?(p("info",s.state.messageSessionExpired,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageSessionExpired:void 0},replace:!0})):(o=s.state)!=null&&o.messageNoToken&&(p("info",s.state.messageNoToken,{position:"top-center",autoClose:3500}),c(s.pathname,{state:{...s.state,messageNoToken:void 0},replace:!0}))},[s.state,c,s.pathname]),n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"auth",children:[n.jsx("div",{className:"auth-header",children:n.jsx(q,{type:u})}),n.jsxs("div",{className:"auth-content",children:[n.jsx(B,{logo:Z,type:u}),n.jsxs("div",{className:`auth-content-core ${u==="signup"?"signup":""}`,children:[n.jsx(J,{values:r,hidePassword:L,setHidePassword:y,validationPassword:T,handleChange:k,handleForm:F,type:u,phoneCodes:E,selectedCode:f,setSelectedCode:$}),u==="login"&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"divider"}),n.jsx(K,{type:u,toastDevelop:V})]})]}),u==="login"?n.jsx(z,{to:"/recovery",className:"auth-content-problems",children:"Can't Log In"}):""]})]}),n.jsx(G,{})]})}O.propTypes={typeMain:Q.string};export{O as default};
