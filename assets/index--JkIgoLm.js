var O={};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var S;function D(){if(S)return O;S=1,O.parse=_,O.serialize=T;var o=Object.prototype.toString,e=Object.prototype.hasOwnProperty,t=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,r=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,u=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,d=/^[\u0020-\u003A\u003D-\u007E]*$/;function _(n,s){if(typeof n!="string")throw new TypeError("argument str must be a string");var i={},c=n.length;if(c<2)return i;var g=s&&s.decode||j,a=0,f=0,h=0;do{if(f=n.indexOf("=",a),f===-1)break;if(h=n.indexOf(";",a),h===-1)h=c;else if(f>h){a=n.lastIndexOf(";",f-1)+1;continue}var p=m(n,a,f),v=b(n,f,p),E=n.slice(p,v);if(!e.call(i,E)){var w=m(n,f+1,h),y=b(n,h,w);n.charCodeAt(w)===34&&n.charCodeAt(y-1)===34&&(w++,y--);var I=n.slice(w,y);i[E]=A(I,g)}a=h+1}while(a<c);return i}function m(n,s,i){do{var c=n.charCodeAt(s);if(c!==32&&c!==9)return s}while(++s<i);return i}function b(n,s,i){for(;s>i;){var c=n.charCodeAt(--s);if(c!==32&&c!==9)return s+1}return i}function T(n,s,i){var c=i&&i.encode||encodeURIComponent;if(typeof c!="function")throw new TypeError("option encode is invalid");if(!t.test(n))throw new TypeError("argument name is invalid");var g=c(s);if(!r.test(g))throw new TypeError("argument val is invalid");var a=n+"="+g;if(!i)return a;if(i.maxAge!=null){var f=Math.floor(i.maxAge);if(!isFinite(f))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+f}if(i.domain){if(!u.test(i.domain))throw new TypeError("option domain is invalid");a+="; Domain="+i.domain}if(i.path){if(!d.test(i.path))throw new TypeError("option path is invalid");a+="; Path="+i.path}if(i.expires){var h=i.expires;if(!x(h)||isNaN(h.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+h.toUTCString()}if(i.httpOnly&&(a+="; HttpOnly"),i.secure&&(a+="; Secure"),i.partitioned&&(a+="; Partitioned"),i.priority){var p=typeof i.priority=="string"?i.priority.toLowerCase():i.priority;switch(p){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(i.sameSite){var v=typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite;switch(v){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return a}function j(n){return n.indexOf("%")!==-1?decodeURIComponent(n):n}function x(n){return o.call(n)==="[object Date]"}function A(n,s){try{return s(n)}catch{return n}}return O}var k=D();function N(){const o=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof o=="boolean"?o:typeof document=="object"&&typeof document.cookie=="string"}function U(o){return typeof o=="string"?k.parse(o):typeof o=="object"&&o!==null?o:{}}function C(o,e={}){const t=L(o);if(!e.doNotParse)try{return JSON.parse(t)}catch{}return o}function L(o){return o&&o[0]==="j"&&o[1]===":"?o.substr(2):o}class M{constructor(e,t={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const u=this.cookies;this.cookies=k.parse(document.cookie),this._checkChanges(u)};const r=typeof document>"u"?"":document.cookie;this.cookies=U(e||r),this.defaultSetOptions=t,this.HAS_DOCUMENT_COOKIE=N()}_emitChange(e){for(let t=0;t<this.changeListeners.length;++t)this.changeListeners[t](e)}_checkChanges(e){new Set(Object.keys(e).concat(Object.keys(this.cookies))).forEach(r=>{e[r]!==this.cookies[r]&&this._emitChange({name:r,value:C(this.cookies[r])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(e,t={}){return t.doNotUpdate||this.update(),C(this.cookies[e],t)}getAll(e={}){e.doNotUpdate||this.update();const t={};for(let r in this.cookies)t[r]=C(this.cookies[r],e);return t}set(e,t,r){r?r=Object.assign(Object.assign({},this.defaultSetOptions),r):r=this.defaultSetOptions;const u=typeof t=="string"?t:JSON.stringify(t);this.cookies=Object.assign(Object.assign({},this.cookies),{[e]:u}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=k.serialize(e,u,r)),this._emitChange({name:e,value:t,options:r})}remove(e,t){const r=t=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),t),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=k.serialize(e,"",r)),this._emitChange({name:e,value:void 0,options:t})}addChangeListener(e){this.changeListeners.push(e),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(e){const t=this.changeListeners.indexOf(e);t>=0&&this.changeListeners.splice(t,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}class l extends Error{}l.prototype.name="InvalidTokenError";function P(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,t)=>{let r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function z(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return P(e)}catch{return atob(e)}}function H(o,e){if(typeof o!="string")throw new l("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,r=o.split(".")[t];if(typeof r!="string")throw new l(`Invalid token specified: missing part #${t+1}`);let u;try{u=z(r)}catch(d){throw new l(`Invalid token specified: invalid base64 for part #${t+1} (${d.message})`)}try{return JSON.parse(u)}catch(d){throw new l(`Invalid token specified: invalid json for part #${t+1} (${d.message})`)}}export{M as C,H as j};
