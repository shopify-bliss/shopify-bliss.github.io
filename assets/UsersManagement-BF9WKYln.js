import{a as j,r,h as S,e as p,j as e,u as M}from"./index-aNMuEpPl.js";import{L as F}from"./LayoutDashboard-B9H3_fEV.js";import{H as L}from"./SupportDashboard-BqCSt7NG.js";import{u as R,a as P}from"./ValidationSchema-C484FGLA.js";import{M as $}from"./Profile-BfMx9gTU.js";import"./AiBuilderSupport-BQThwhNR.js";import"./black-logo-KPU1N9jl.js";import"./AuthSupport-BuMUHgk3.js";function k({type:d,onOpen:i,onClose:l,refreshData:n,userId:c}){j.defaults.withCredentials=!0;const[f,b]=r.useState([]),[s,v]=r.useState({email:"",username:"",phoneNumber:"",roleID:""}),[o,h]=r.useState({userID:"",role:""}),[N,y]=r.useState(!1),_=r.useRef(null),{toastMessage:D,toastPromise:g,token:m,user:C}=S();r.useEffect(()=>{j.get(p.role,{headers:{Authorization:`Bearer ${m}`}}).then(a=>{b(a.data.data)}).catch(a=>{console.error("Error fetching roles:",a)})},[p.role,m]);const x=r.useCallback(a=>{_.current&&!_.current.contains(a.target)&&y(!1)},[_]);r.useEffect(()=>(N?document.addEventListener("mousedown",x):document.removeEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}),[N]),r.useEffect(()=>{i&&d==="update"&&j.get(`${p.userId}?userID=${c}`,{headers:{Authorization:`Bearer ${m}`}}).then(a=>{h({userID:a.data.data.user_id,role:a.data.data.role_id})}).catch(a=>{console.error("Error fetching user data:",a)})},[i,d,p.userId,c,m]);const E=a=>{const{name:t,value:u}=a.target;v({...s,[t]:u})},U=r.useCallback(a=>{a.preventDefault(),d==="create"?R.validate(s,{abortEarly:!1}).then(()=>{const t=j.post(p.addAdmin,s,{headers:{Authorization:`Bearer ${m}`}});g(t,{pending:"Adding user data on progress, please wait..!",success:"Data has been successfully added!",error:"Failed to add data!"},{autoClose:2500,position:"top-center"},()=>{l(),n()}),t.catch(u=>{console.error("Error adding user data:",u)})}).catch(t=>{t.inner.forEach(u=>{D("error",u.message)})}):(console.log(o),P.validate(o,{abortEarly:!1}).then(()=>{const t=j.put(p.updateUserRole,o,{headers:{Authorization:`Bearer ${m}`}});g(t,{pending:"Updating user role data on progress, please wait..!",success:"Data has been successfully updated!",error:"Failed to update data!"},{autoClose:2500,position:"top-center"},()=>{l(),n()}),t.catch(u=>{console.error("Error updating user role data:",u)})}).catch(t=>{t.inner.forEach(u=>{D("error",u.message)})}))},[R,s,o,l,n,D,g,c,m,p]),w=r.useCallback(a=>{a.preventDefault();const t=j.delete(`${p.userId}?userID=${c}`,{headers:{Authorization:`Bearer ${m}`}});g(t,{pending:"deleting user data on progress, please wait..!",success:"Data has been successfully deleted!",error:"Failed to delete data!"},{autoClose:2500,position:"top-center"},()=>{l(),n()}),t.catch(u=>{console.error("Error deleting user data:",u)})},[c,m,l,n]);return e.jsx(e.Fragment,{children:d==="delete"?e.jsx($,{onClose:l,onOpen:i,type:"confirm",titleModal:"Are you sure you want to delete this?",descModal:"Your content will be permanently deleted. This can't be undone.",children:e.jsxs("div",{className:"confirm-dashboard-action",children:[e.jsx("div",{className:"cancel",onClick:l,children:"cancel"}),e.jsx("div",{className:"confirm",onClick:w,children:"delete"})]})}):e.jsx($,{titleModal:d==="create"?"Insert Section Data":"Update Section Data",onOpen:i,onClose:l,children:e.jsxs("form",{className:"modal-dashboard-form",onSubmit:U,children:[d==="create"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"username",children:["Username ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"username",name:"username",placeholder:"Example",value:s.username,onChange:E})]}),e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"email",name:"email",placeholder:"example@gmail.com",value:s.email,onChange:E})]}),e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("label",{htmlFor:"phoneNumber",children:["Phone Number ",e.jsx("span",{children:"(Required)"})]}),e.jsx("input",{type:"text",id:"phoneNumber",name:"phoneNumber",placeholder:"628123456789",value:s.phoneNumber,onChange:E})]})]}):null,e.jsxs("div",{className:"modal-dashboard-form-group",children:[e.jsxs("div",{className:"label",children:["Role ",e.jsx("span",{children:"(Required)"})]}),e.jsxs("div",{className:"select-default",onClick:()=>y(!0),children:[e.jsx("div",{className:"text",children:o.role===""?"Choose Role":f.filter(a=>a.role_id===o.role).map(a=>a.role_name)}),e.jsx("span",{className:`material-symbols-outlined ${N?"default-closed":""}`,children:"south_east"})]}),N&&e.jsx("div",{className:"select-list no-more",ref:_,children:f.filter(a=>a.role_id!==o.role&&a.role_id!=="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"&&(C.role_id!=="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?a.role_id!=="0057ae60-509f-40de-a637-b2b6fdc1569e":a.role_id)).map(a=>e.jsx("div",{className:"select-list-item",onClick:()=>{h({...o,role:a.role_id}),y(!1)},children:e.jsx("div",{className:"name",children:a.role_name})},a.role_id))})]}),e.jsx("button",{type:"submit",children:"Submit"})]})})})}function A({isLoadingDashboard:d,users:i,user:l,setUserId:n,setIsUpdateModalOpen:c,setIsDeleteModalOpen:f,type:b}){return e.jsxs(e.Fragment,{children:[d&&e.jsx("div",{className:"loader-pages",children:e.jsx("div",{className:"loader-pages-item"})}),b==="grid"?e.jsx("div",{className:"display-users-grid",children:i.map(s=>{const v=`/avatar/${s.avatar}`,o=l.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80":s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"||s.role_id==="0057ae60-509f-40de-a637-b2b6fdc1569e";return e.jsxs("div",{className:"item",children:[e.jsx("img",{className:"item-avatar",src:v,alt:"Avatar's User"}),e.jsx("div",{className:"item-username",children:s.username}),e.jsx("div",{className:"item-email",children:s.email}),e.jsxs("div",{className:"item-phone-number",children:["+",s.phone_number]}),e.jsxs("div",{className:"item-action",children:[e.jsxs("div",{className:`item-action-role ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:[e.jsx("span",{className:`material-symbols-outlined item-action-role-icon ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name==="super admin"?"admin_panel_settings":s.roles.role_name==="admin"?"manage_accounts":s.roles.role_name==="customer"?"person":"deployed_code_account"}),e.jsx("span",{className:`item-action-role-text ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name||"Super Whooo"})]}),e.jsx("span",{className:"material-symbols-rounded item-action-edit",onClick:o?null:()=>{c(!0),n(s.user_id)},children:o?"block":"edit_square"}),e.jsx("span",{className:"material-symbols-rounded item-action-delete",onClick:o?null:()=>{f(!0),n(s.user_id)},children:o?"block":"delete"})]})]},s.user_id)})}):e.jsxs("div",{className:"display-users-list",children:[e.jsxs("div",{className:"head",children:[e.jsx("div",{className:"head-col",children:"No"}),e.jsx("div",{className:"head-col",children:"General Info"}),e.jsx("div",{className:"head-col",children:"Phone Number"}),e.jsx("div",{className:"head-col",children:"Role"}),e.jsx("div",{className:"head-col",children:"Action"})]}),i.map((s,v)=>{const o=`/avatar/${s.avatar}`,h=l.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"?s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80":s.role_id==="3de65f44-6341-4b4d-8d9f-c8ca3ea80b80"||s.role_id==="0057ae60-509f-40de-a637-b2b6fdc1569e";return e.jsxs("div",{className:"body",children:[e.jsx("div",{className:"body-col",children:v+1}),e.jsxs("div",{className:"body-col",children:[e.jsx("img",{className:"avatar",src:o,alt:"Avatar's User"}),e.jsxs("div",{className:"info",children:[e.jsx("div",{className:"info-username",children:s.username}),e.jsx("div",{className:"info-email",children:s.email})]})]}),e.jsxs("div",{className:"body-col",children:["+",s.phone_number]}),e.jsx("div",{className:"body-col",children:e.jsx("div",{className:`body-col-role ${s.roles.role_name==="super admin"?"super-admin":s.roles.role_name==="admin"?"admin":s.roles.role_name==="customer"?"customer":""}`,children:s.roles.role_name||"Super Whooo"})}),e.jsxs("div",{className:"body-col",children:[e.jsx("span",{className:"material-symbols-rounded edit",onClick:h?null:()=>{c(!0),n(s.user_id)},children:h?"block":"edit_square"}),e.jsx("span",{className:"material-symbols-rounded delete",onClick:h?null:()=>{f(!0),n(s.user_id)},children:h?"block":"delete"})]})]},s.user_id)})]})]})}function q(){j.defaults.withCredentials=!0;const[d,i]=r.useState([]),[l,n]=r.useState("list"),[c,f]=r.useState(!1),[b,s]=r.useState(!1),[v,o]=r.useState(!1),[h,N]=r.useState(""),{token:y,user:_,isLoadingDashboard:D,setDashboardLoader:g}=S(),m=r.useCallback(x=>{n(x)},[]),C=r.useCallback(async()=>{g(!0);try{const x=await j.get(p.allusers,{headers:{Authorization:`Bearer ${y}`}});i(x.data.data)}catch(x){console.error(x)}finally{g(!1)}},[p.allusers,y]);return r.useEffect(()=>{C()},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"display-users",children:[e.jsx(L,{className:"display-users",title:"Users Management â€” Display Data",activeDisplay:l,handleDisplayChange:m,setIsCreateModalOpen:f}),l==="grid"?e.jsx(A,{isLoadingDashboard:D,users:d,user:_,setUserId:N,setIsUpdateModalOpen:s,setIsDeleteModalOpen:o,type:"grid"}):e.jsx(A,{isLoadingDashboard:D,users:d,user:_,setUserId:N,setIsUpdateModalOpen:s,setIsDeleteModalOpen:o,type:"list"}),e.jsx(k,{type:"create",onOpen:c,onClose:()=>f(!1),refreshData:C}),e.jsx(k,{type:"update",onOpen:b,onClose:()=>s(!1),refreshData:C,userId:h}),e.jsx(k,{type:"delete",onOpen:v,onClose:()=>o(!1),refreshData:C,userId:h})]})})}function V(){const{submenuPage:d,accessMenus:i,user:l}=S(),n=M();return r.useEffect(()=>{const c=setTimeout(()=>{(i==null?void 0:i.some(b=>b.role_id===(l==null?void 0:l.role_id)&&b.menu_id==="3e1f3895-691f-4962-af43-225d73cfcf91"))===!1&&n("/403",{replace:!0})},1e4);return()=>clearTimeout(c)},[i,l,n]),e.jsx(e.Fragment,{children:e.jsx(F,{children:d==="display data"&&e.jsx(q,{})})})}export{V as default};
